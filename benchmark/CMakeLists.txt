option(EASY_JIT_BENCHMARK "Enable benchmarking" OFF)

if(EASY_JIT_BENCHMARK)
    set(CMAKE_CXX_COMPILER ${LLVM_TOOLS_BINARY_DIR}/clang++)
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Xclang -disable-O0-optnone -Xclang -load -Xclang ${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/EasyJitPass${CMAKE_SHARED_LIBRARY_SUFFIX}")
    add_executable(easyjit-benchmark benchmark.cpp)
    find_package(Benchmark REQUIRED)
    if(Benchmark_FOUND)
        include_directories(${Benchmark_INCLUDE_DIRS})
        link_directories(${CMAKE_LIBRARY_OUTPUT_DIRECTORY})
        target_link_libraries (easyjit-benchmark ${Benchmark_LIBRARIES})
        target_link_libraries (easyjit-benchmark EasyJitRuntime)
    endif()
endif()
