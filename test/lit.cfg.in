import lit.formats
import lit.util
import os

config.name = 'easy_jit'
config.suffixes = ['.c', '.cpp', '.ll', '.test']

config.test_format = lit.formats.ShTest(True)

config.test_source_root = "@CMAKE_CURRENT_SOURCE_DIR@"
config.test_exec_root = "@CMAKE_CURRENT_BINARY_DIR@"

config.environment['PATH'] = os.pathsep.join(["@LLVM_TOOLS_BINARY_DIR@"] + [ config.environment['PATH'] ])

runtime_lib = os.path.basename("@EASY_JIT_RUNTIME@").split('.')[0].replace("lib", "", 1)
runtime_lib_path = os.path.dirname("@EASY_JIT_RUNTIME@")

# substitutions
config.substitutions.append(('%includepath', os.path.join("@EASY_JIT_ROOT@", "include")))
config.substitutions.append(('%load_static_lib', "-load @EASY_JIT_PASS@ -easy_jit"))
config.substitutions.append(('%ldlib', runtime_lib))
config.substitutions.append(('%ldpath', runtime_lib_path))
config.substitutions.append(('%ldflags', "-L" + runtime_lib_path + " -l" + runtime_lib + " -rpath " + runtime_lib_path))
